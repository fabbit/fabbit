  <div class="nav_list">

    <div class="expand">
      expand all
    </div>

    <ul class="row files list">

      <li class="folder open">
          <div class="action opener"></div>
          <div> Your Dropbox </div>
          <%= render "layouts/directory", directory: @directories %>
      </li>
    </ul>

    <script>

      $(".files.list .folder").each(function(i, el) {

        $(el).unbind("click");

        var opened = false;

        $(el).on("click", "> div",function(event){
          var folderList = $(event.target).parent();

          if (! opened){
            console.log("OPENING" + $($(folderList).find(".name")[0]).html());
            $(folderList).addClass("open");
            opened = true;
          } else {
            console.log("CLOSING" + $($(folderList).find(".name")[0]).html());
            $(folderList).removeClass("open");
            opened = false;
          }
         
       
        });

      });

      var state = "open";
      $(".expand").click(function(){

        var opener = $(this);
        var folders = $(".files.list").find(".folder");
        console.log(folders);

        if (state === "open") {
         $.each(folders, function(i,folder){
            if (! $(folder).hasClass('open')) { 
              $(folder).addClass('open')
            }
            state = "close";
            $(opener).html("collapse all");
          });
        } else {
          $.each(folders, function(i,folder){
            if ($(folder).hasClass('open')) { 
              $(folder).removeClass('open')
            };
            state = "open";
            $(opener).html("expand all");
          });
        }
          
      });
    </script>

</div>
